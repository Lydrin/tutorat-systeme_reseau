<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Graphiques</title>
        <script src="Chart.min.js"></script>
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    </head>

    <body>

		<div class="w3-container w3-padding-32" style="background-color:#6D214F">

			<form class="w3-container" style="width:50%" name="monFormulaire">
				<h2 style="color:#FFFFFF">Choix du groupe</h2>
				<select class="w3-select" name="myselect" id="myselecjt" onchange="afficher_graphique();">
					<option value=""></option>
				</select>
				<select class="w3-select" name="myselect2" id="myselecjt2" onchange="afficher_graphique();">
					<option value="accel">Accéléromètre</option>
					<option value="temp">Température</option>
				</select>
			</form>

		</div>

		<div class="chart-container" style="position: relative; height:10vh; width:60vw; padding: 30px">
			<canvas id="line-chart"></canvas>
		</div>


    </body>

</html>

<script>

    function httpGet(url) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", url, false);
	    xmlHttp.overrideMimeType("text/plain; charset=x-user-defined");
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    function afficher_graphique() {
        var choix = document.getElementById("myselecjt").value;
        var choix2 = document.getElementById("myselecjt2").value;
        console.log("Choix : "+choix+" / "+choix2);

        if(choix2 == "temp") {
            var nom_fichier = "TID_"+choix;
			var f_temp = httpGet("data/"+nom_fichier).split('\n');
			f_temp.pop();
			new Chart(document.getElementById("line-chart"), {
				type: 'line',
				data: {
					labels: [1,2,3,4], //heure, date, numero ??
					datasets: [
						{
							data: f_temp,
							label: "Groupe "+choix,
							borderColor: 'rgb(230, 126, 34)',
							fill: false
						}
					]
				},
				options: {
					title: {
						display: true,
						text: 'Température - Gr.'+choix
					}
				}
			});

        }
        else if(choix2 == "accel") {
            var nom_fichier2 = "AID_"+choix;
			var f_accel = httpGet("data/"+nom_fichier2).split('\n');
			f_accel.pop();
			var x = [], y = [], z = [];
			for(var i = 0; i < f_accel.length; i++) {
				x.push(f_accel[i].split(',')[0]);
				y.push(f_accel[i].split(',')[1]);
				z.push(f_accel[i].split(',')[2]);
			}
			new Chart(document.getElementById("line-chart"), {
				type: 'line',
				data: {
					labels: [1,2,3,4], //heure, date, numero ??
					datasets: [
						{
							data: x,
							label: "Axe x",
							fill: false,
							borderColor: 'rgb(231, 76, 60)'
						},
						{
							data: y,
							label: "Axe y",
							fill: false,
							borderColor: 'rgb(39, 174, 96)'
						},
						{
							data: z,
							label: "Axe z",
							fill: false,
							borderColor: 'rgb(41, 128, 185)'
						}
					]
				},
				options: {
					title: {
						display: true,
						text: 'Accéléromètre - Gr.'+choix
					}
				}
			});

        }


    }

    var data = httpGet("data/list_ID").split('\n');
    data.pop();
    document.monFormulaire.myselect.options.length = data.length;
    for (var j = 0; j < data.length; j++) {
          document.monFormulaire.myselect.options[j].value = data[j];
          document.monFormulaire.myselect.options[j].text = data[j];
    }

    afficher_graphique();



    window.setInterval(function(){
        var data2 = httpGet("data/list_ID").split('\n');
        data2.pop();
        if(data.join() != data2.join()) {
            console.log(data);
            console.log(data2);
            location.reload();
        }
    }, 2000);



</script>
